# Informe Pentesting

# SQLi
En el campo "User" del formulario de inicio de sesión de la página `list_players.php`, la consulta SQL que se ejecuta es vulnerable a un ataque de inyección SQL. Por ejemplo, si usamos la doble comilla `"`: 

![Imagen 1](/img/1.png)

Pulsamos en login y nos muestra el error obtenido: 
![Imagen 2](/img/2.png)

El código actual ejecuta la consulta SQL de la siguiente manera:
```php
SELECT userId, password FROM users WHERE username = 'user_input' AND password = 'password_input'
```


---

Para poder conocer la contraseña y entrar en la aplicación web, usaremos el diccionario que nos proporcionaron, haciendo un ataque de diccionario. Este ataque consiste en probar diversas combinaciones de contraseñas usando la inyección SQL. Para realizar este ataque usaremos el siguiente payload en el campo `User`:

```
" OR password="1234" --
```

![Imagen 3](/img/3.png)

Así podemos comprobar como hemos iniciado sesión en la página con una cuenta cuya contraseña es 1234:
![Imagen 4](/img/4.png)


Para comprobar el nombre del usuario con el que hemos iniciado sesión traté de buscar algún dato en las cookies, pero no lo mostraba:
![Imagen 5](/img/5.png)

Para saber el nombre finalmente lo que hice fue hacer un comentario en uno de los jugadores, al hacer el comentario y mostrarlo, podíamos ver el nombre del usuario que introdujo dicho comentario.

Estos son los comentarios que había antes de realizar el mío:

![Imagen 6](/img/6.png)

<br>
El comentario que yo realizado:

![Imagen 7](/img/7.png)

<br>
Los comentarios actualizados donde podemos ver el nombre del usuario:

![Imagen 8](/img/8.png)

Se puede comprobar que el nombre de usuario es **luis**, es decir, podemos iniciar sesión con el nombre luis y la contraseña que usamos con anterioridad.

<br>

---

# XSS
En el formulario de comentarios de `add_comment.php`, se puede insertar código JavaScript malicioso en el campo de texto del comentario, lo que se ejecutará cuando otro usuario visualice el comentario.

**Payload Utilizado:**
```html
<script>alert('¡Vulnerabilidad XSS!');</script>
```

<br>

Inyectamos el payload en el comentario:

![Imagen 9](/img/9.png)

Una vez ponemos el comentario debemos pulsar en `show/add comments`:

![Imagen 10](/img/10.png)

Nos debe mostrar una alerta como la siguiente:

![Imagen 11](/img/11.png)

Y si vemos los comentarios, este saldrá en blanco:

![Imagen 12](/img/12.png)

<br>

---


## Otras páginas afectadas por XSS
### - `insert_player.php`

Se descubrió una vulnerabilidad en el campo team:

Esta es la captura antes de la inyección:

![Imagen 13](/img/13.png)

El **payload utilizado** es el siguiente:

```html
<br>
<br>
<br>
<a href="http://web.pagos/donate.php?amount=100&receiver=attacker">Profile</a>
```
![Imagen 14](/img/14.png)

Al darle a `Send` nos aparecerá el botón en el recuadro:

![Imagen 15](/img/15.png)
<br>

---

### - `buscador.html`
El objetivo era hacer que la donación se realizara automáticamente sin que el usuario tuviera que hacer clic en el botón.

Para ello se introujo un payload en un comentario, de manera que cuando cualquier usuario entrara en los comentarios, este payload se activaría, abriendo la página de donación en segundo plano. Por lo que esta donación se realizaría automáticamente sin que el propio usuario se diera cuenta.

El payload utilizado es el siguiente:
```php
<script>
  var xhr = new XMLHttpRequest();
  xhr.open("GET", "http://web.pagos/donate.php?amount=100&receiver=attacker", true);
  xhr.send();
</script>
```

Lo insertamos en un comentario:

![Imagen 16](/img/16.png)

Y cuando pinchamos en comentarios, se nos abre la página de normal, pero si vemos en inspeccionar, se puede comprobar como se ha ejecutado el script:

![Imagen 17](/img/17.png)